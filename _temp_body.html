<!-- Background / Canvas Area -->
<div id="canvas-wrapper"
    class="absolute inset-0 z-0 flex items-center justify-center p-8 bg-[#09090b] bg-[radial-gradient(#18181b_1px,transparent_1px)] [background-size:20px_20px]">
    <canvas id="main-canvas" width="800" height="500" class="shadow-2xl rounded-sm bg-white"></canvas>
</div>

<!-- 1. Top Header (Glass) -->
<div
    class="absolute top-0 left-0 right-0 h-14 z-20 flex items-center justify-between px-6 bg-zinc-900/40 backdrop-blur-md border-b border-white/5 pointer-events-auto">
    <div class="flex items-center space-x-6">
        <div class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/20">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z">
                    </path>
                </svg>
            </div>
            <span class="text-lg font-bold tracking-tight text-white">Stick<span
                    class="text-blue-500">Motion</span></span>
        </div>

        <div class="h-6 w-px bg-white/10 mx-2"></div>

        <div class="flex items-center space-x-1">
            <button onclick="app.undo()"
                class="p-2 text-zinc-400 hover:text-white hover:bg-white/5 rounded-md transition" title="Undo">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path>
                </svg>
            </button>
            <button onclick="app.redo()"
                class="p-2 text-zinc-400 hover:text-white hover:bg-white/5 rounded-md transition" title="Redo">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"></path>
                </svg>
            </button>
        </div>

        <!-- Zoom Pill -->
        <div class="flex items-center space-x-2 bg-black/20 rounded-full px-3 py-1 border border-white/5 ml-4">
            <button onclick="app.changeZoom(-0.1)"
                class="text-zinc-400 hover:text-blue-400 font-bold text-lg leading-none">-</button>
            <span id="zoom-display" class="text-xs font-mono w-10 text-center text-zinc-300">100%</span>
            <button onclick="app.changeZoom(0.1)"
                class="text-zinc-400 hover:text-blue-400 font-bold text-lg leading-none">+</button>
        </div>
    </div>

    <div class="flex items-center space-x-3">
        <div class="flex items-center space-x-1 text-xs">
            <button onclick="app.confirmNewProject()"
                class="px-3 py-2 text-zinc-400 hover:text-white hover:bg-white/5 rounded-md transition">New</button>
            <button onclick="app.saveProject()"
                class="px-3 py-2 text-zinc-400 hover:text-white hover:bg-white/5 rounded-md transition">Save</button>
            <button onclick="document.getElementById('load-input').click()"
                class="px-3 py-2 text-zinc-400 hover:text-white hover:bg-white/5 rounded-md transition">Load</button>
            <input type="file" id="load-input" class="hidden" accept=".json" onchange="app.loadProject(this)">
        </div>
        <button onclick="app.exportGif()"
            class="ml-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-lg shadow-lg shadow-blue-600/20 transition flex items-center space-x-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
            </svg>
            <span>Export</span>
        </button>
        <button onclick="app.toggleTheme()" class="hidden p-2 text-zinc-500 hover:text-white"><svg class="w-5 h-5"
                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                </path>
            </svg></button>
    </div>
</div>

<!-- 2. Floating Left Toolbar (Tools) -->
<div class="absolute left-6 top-1/2 -translate-y-1/2 flex flex-col items-center gap-4 p-3 z-30 pointer-events-auto">
    <div class="flex flex-col gap-2 p-2 bg-zinc-900/80 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl">
        <!-- Tools -->
        <button
            class="w-10 h-10 flex items-center justify-center rounded-xl bg-blue-600 text-white shadow-lg shadow-blue-600/20"
            title="Select Tool">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122">
                </path>
            </svg>
        </button>
        <button onclick="app.addFigure()"
            class="w-10 h-10 flex items-center justify-center rounded-xl text-zinc-400 hover:text-white hover:bg-white/10 transition"
            title="Add Stickman">
            <span class="text-xl">üèÉ</span>
        </button>
        <button onclick="app.openLibrary()"
            class="w-10 h-10 flex items-center justify-center rounded-xl text-zinc-400 hover:text-white hover:bg-white/10 transition"
            title="Library">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z">
                </path>
            </svg>
        </button>
        <button onclick="app.addText()"
            class="w-10 h-10 flex items-center justify-center rounded-xl text-zinc-400 hover:text-white hover:bg-white/10 transition"
            title="Add Text">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                </path>
            </svg>
        </button>
        <button onclick="app.openBuilder()"
            class="w-10 h-10 flex items-center justify-center rounded-xl text-zinc-400 hover:text-white hover:bg-white/10 transition"
            title="Custom Builder">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
                </path>
            </svg>
        </button>

        <div class="h-px w-full bg-white/10 my-1"></div>

        <button onclick="app.deleteSelectedFigure()"
            class="w-10 h-10 flex items-center justify-center rounded-xl text-red-400 hover:text-red-300 hover:bg-red-500/20 transition"
            title="Delete Selected">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                </path>
            </svg>
        </button>
    </div>
</div>

<!-- 3. Floating Right Inspector (Properties) -->
<div class="absolute right-6 top-20 bottom-32 w-72 flex flex-col gap-4 z-20 pointer-events-none">
    <!-- Main Properties Panel -->
    <div
        class="bg-zinc-900/80 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl p-4 flex flex-col gap-4 pointer-events-auto overflow-y-auto max-h-full">

        <!-- Section: Selection -->
        <div>
            <h3 class="text-[11px] font-bold text-zinc-500 uppercase tracking-wider mb-3">Selection</h3>

            <!-- Color & basic actions -->
            <div class="grid grid-cols-2 gap-2 mb-3">
                <div class="relative group h-9">
                    <input type="color" id="color-picker" class="absolute opacity-0 w-full h-full cursor-pointer z-10"
                        onchange="app.setFigureColor(this.value)">
                    <div
                        class="w-full h-full bg-zinc-800 rounded-lg border border-zinc-700 flex items-center px-2 group-hover:border-zinc-500 transition">
                        <div id="color-preview" class="w-5 h-5 rounded-md bg-white mr-2 shadow-sm"></div>
                        <span class="text-xs text-zinc-400">Color</span>
                    </div>
                </div>
            </div>

            <!-- Transform Controls -->
            <div class="bg-zinc-800/50 rounded-lg p-2 flex justify-between items-center mb-2">
                <button onclick="app.flipFigure()"
                    class="p-1.5 text-zinc-400 hover:text-white rounded hover:bg-zinc-700" title="Flip X"><svg
                        class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                    </svg></button>
                <button onclick="app.centerFigure()"
                    class="p-1.5 text-zinc-400 hover:text-white rounded hover:bg-zinc-700" title="Center"><svg
                        class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4">
                        </path>
                    </svg></button>
                <div class="w-px h-4 bg-zinc-700"></div>
                <button onclick="app.raiseFigure()"
                    class="p-1.5 text-zinc-400 hover:text-white rounded hover:bg-zinc-700" title="Bring to Front"><svg
                        class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                    </svg></button>
                <button onclick="app.lowerFigure()"
                    class="p-1.5 text-zinc-400 hover:text-white rounded hover:bg-zinc-700" title="Send Back"><svg
                        class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg></button>
            </div>

            <div class="grid grid-cols-2 gap-2">
                <button onclick="app.scaleFigure(1.1)"
                    class="bg-zinc-800/50 hover:bg-zinc-700 text-zinc-400 hover:text-white py-1.5 rounded-lg text-xs font-medium transition">Scale
                    +</button>
                <button onclick="app.scaleFigure(0.9)"
                    class="bg-zinc-800/50 hover:bg-zinc-700 text-zinc-400 hover:text-white py-1.5 rounded-lg text-xs font-medium transition">Scale
                    -</button>
            </div>
        </div>

        <div class="h-px bg-white/5 my-1"></div>

        <!-- Section: Text Edit (Moved from Left) -->
        <div id="text-editor-panel" class="hidden">
            <label class="text-[11px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block">Edit Text</label>
            <textarea id="text-figure-input" rows="2"
                class="w-full bg-zinc-950 border border-zinc-700 rounded-lg p-2 text-sm text-white focus:outline-none focus:border-blue-500 mb-2"
                oninput="app.updateText(this.value)"></textarea>
        </div>

        <!-- Section: Stage -->
        <div>
            <h3 class="text-[11px] font-bold text-zinc-500 uppercase tracking-wider mb-3">Stage</h3>
            <div class="grid grid-cols-2 gap-2 mb-3">
                <div class="space-y-1">
                    <label class="text-[10px] text-zinc-500 font-bold">W</label>
                    <input type="number" id="canvas-w" value="800"
                        class="w-full bg-zinc-950 text-zinc-300 text-xs p-2 rounded-lg border border-zinc-800 focus:border-blue-500 focus:outline-none font-mono"
                        onchange="app.setCanvasSize()">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] text-zinc-500 font-bold">H</label>
                    <input type="number" id="canvas-h" value="500"
                        class="w-full bg-zinc-950 text-zinc-300 text-xs p-2 rounded-lg border border-zinc-800 focus:border-blue-500 focus:outline-none font-mono"
                        onchange="app.setCanvasSize()">
                </div>
            </div>

            <button onclick="document.getElementById('bg-input').click()"
                class="w-full text-xs bg-zinc-800 hover:bg-zinc-700 text-zinc-300 py-2 rounded-lg transition mb-2">Set
                Background</button>
            <input type="file" id="bg-input" class="hidden" accept="image/*" onchange="app.loadBackground(this)">

            <button onclick="app.confirmClearStage()"
                class="w-full text-xs text-red-400 hover:bg-red-500/10 py-2 rounded-lg transition flex items-center justify-center">
                <svg class="w-3 h-3 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                    </path>
                </svg>
                Clear Stage
            </button>
        </div>

    </div>
</div>


<!-- 4. Floating Bottom Timeline -->
<div class="absolute bottom-6 left-6 right-6 h-36 z-20 pointer-events-none">
    <div
        class="w-full h-full bg-zinc-900/80 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl flex flex-col pointer-events-auto overflow-hidden">

        <!-- Timeline Controls Bar -->
        <div class="h-10 border-b border-white/5 flex items-center justify-between px-4 bg-black/20">
            <!-- Playback -->
            <div class="flex items-center space-x-2">
                <button onclick="app.goToFirstFrame()" class="p-1 text-zinc-400 hover:text-white"><svg class="w-4 h-4"
                        fill="currentColor" viewBox="0 0 24 24">
                        <path d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path>
                    </svg></button>
                <button onclick="app.play()" id="btn-play-btm"
                    class="w-8 h-8 flex items-center justify-center bg-blue-600 hover:bg-blue-500 text-white rounded-full shadow-lg shadow-blue-600/20 transition"><svg
                        class="w-4 h-4 ml-0.5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z" />
                    </svg></button>
                <button onclick="app.stop()" id="btn-stop-btm"
                    class="hidden w-8 h-8 flex items-center justify-center bg-red-500 hover:bg-red-400 text-white rounded-full shadow-lg shadow-red-500/20 transition"><svg
                        class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M6 6h12v12H6z" />
                    </svg></button>

                <div class="h-4 w-px bg-white/10 mx-2"></div>

                <button type="button" onclick="app.toggleLoop()" id="btn-loop-btm"
                    class="text-[10px] px-2 py-1 rounded bg-zinc-800 text-zinc-400 border border-zinc-700 hover:text-white transition">Loop</button>
                <button type="button" onclick="app.toggleSmooth()" id="btn-smooth-btm"
                    class="text-[10px] px-2 py-1 rounded bg-zinc-800 text-zinc-400 border border-zinc-700 hover:text-white transition">Smooth</button>
            </div>

            <span class="text-xs font-mono text-zinc-600" id="frame-counter">0 / 0</span>

            <!-- FPS / Frame Settings -->
            <div class="flex items-center space-x-4">
                <!-- Onion Skin -->
                <div class="flex items-center space-x-2">
                    <label class="text-[10px] text-zinc-500 font-bold">ONION</label>
                    <input type="checkbox" id="onion-check" checked class="accent-blue-500 w-3 h-3"
                        onchange="app.render()">
                </div>

                <div class="w-px h-4 bg-white/10"></div>

                <!-- FPS -->
                <div class="flex items-center space-x-2">
                    <span class="text-[10px] text-zinc-500 font-bold">FPS</span>
                    <input type="range" min="1" max="30" value="12"
                        class="w-20 h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer"
                        oninput="app.updateFps(this.value)">
                    <span id="fps-display" class="text-[10px] font-mono text-zinc-400 w-4">12</span>
                </div>

                <div class="w-px h-4 bg-white/10"></div>

                <!-- Duration -->
                <div class="flex items-center space-x-2">
                    <span class="text-[10px] text-zinc-500 font-bold">DURATION</span>
                    <span id="duration-display" class="text-[10px] font-mono text-blue-400 w-8 text-right">1.0x</span>
                    <input type="range" min="0.1" max="10.0" step="0.1" value="1.0" id="frame-duration"
                        class="w-20 h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer"
                        oninput="app.setFrameDuration(this.value)">
                </div>
            </div>
        </div>

        <!-- Timeline Strip -->
        <div class="flex-1 bg-black/40 overflow-x-auto timeline-scroll flex items-center p-3 space-x-3"
            id="timeline-track">
            <!-- Thumbnails injected here -->
        </div>

        <!-- Frame Actions Control (Add/Move) Overlay -->
        <div class="h-8 border-t border-white/5 bg-zinc-900/50 flex items-center justify-center space-x-2">
            <button onclick="app.moveFrame(-1)"
                class="w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-zinc-500 hover:text-white transition"><svg
                    class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg></button>
            <button onclick="app.addFrame()"
                class="flex items-center space-x-1 px-3 py-0.5 bg-blue-600 hover:bg-blue-500 text-white text-[10px] font-bold rounded-full transition shadow-lg shadow-blue-600/20">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span>ADD FRAME</span>
            </button>
            <button onclick="app.moveFrame(1)"
                class="w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-zinc-500 hover:text-white transition"><svg
                    class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg></button>
        </div>
    </div>
</div>

<!-- Modals (Re-inserting existing modals with dark styles updated) -->

<!-- Figure Designer Modal -->
<div id="builder-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div
        class="bg-zinc-900 border border-zinc-700 w-full h-full sm:w-[800px] sm:h-[550px] sm:rounded-2xl shadow-2xl flex flex-col sm:flex-row overflow-hidden">
        <div class="flex-1 bg-[#18181b] relative flex items-center justify-center overflow-hidden cursor-crosshair"
            id="builder-canvas-container">
            <canvas id="builder-canvas" width="600" height="550" class="max-w-full max-h-full"></canvas>
            <div class="absolute top-4 left-4 text-zinc-700 text-xs font-bold pointer-events-none">DESIGNER</div>
        </div>
        <div class="w-full sm:w-72 bg-zinc-850 border-l border-zinc-800 flex flex-col p-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-white">Figure Designer</h3>
                <button onclick="builder.close()" class="text-zinc-500 hover:text-white">‚úï</button>
            </div>

            <div class="space-y-6 flex-1">
                <div>
                    <label class="text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block">Tools</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="builder.addSegment('line')"
                            class="flex flex-col items-center p-3 bg-zinc-800 hover:bg-zinc-700 rounded-xl border border-zinc-700 transition">
                            <div class="w-6 h-0.5 bg-zinc-400 mb-2"></div>
                            <span class="text-[10px] text-zinc-400">Line</span>
                        </button>
                        <button onclick="builder.addSegment('circle')"
                            class="flex flex-col items-center p-3 bg-zinc-800 hover:bg-zinc-700 rounded-xl border border-zinc-700 transition">
                            <div class="w-4 h-4 rounded-full border-2 border-zinc-400 mb-2"></div>
                            <span class="text-[10px] text-zinc-400">Circle</span>
                        </button>
                    </div>
                </div>

                <div id="builder-props" class="opacity-50 pointer-events-none transition-opacity">
                    <label
                        class="text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block">Properties</label>
                    <div class="space-y-4 bg-zinc-800/50 p-3 rounded-xl">
                        <div>
                            <div class="flex justify-between text-[10px] text-zinc-400 mb-1"><span>Thickness</span><span
                                    id="b-thick-val" class="text-white">14</span></div>
                            <input type="range" min="2" max="40" value="14" id="b-thickness"
                                class="w-full h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer"
                                oninput="builder.updateProp('thickness', this.value)">
                        </div>
                        <div>
                            <div class="flex justify-between text-[10px] text-zinc-400 mb-1"><span>Length</span><span
                                    id="b-len-val" class="text-white">40</span></div>
                            <input type="range" min="0" max="200" value="40" id="b-length"
                                class="w-full h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer"
                                oninput="builder.updateProp('length', this.value)">
                        </div>
                        <div id="b-circle-controls" class="hidden space-y-4 pt-2 border-t border-white/5">
                            <div>
                                <div class="flex justify-between text-[10px] text-zinc-400 mb-1">
                                    <span>Radius</span><span id="b-rad-val" class="text-white">20</span></div>
                                <input type="range" min="5" max="100" value="20" id="b-radius"
                                    class="w-full h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer"
                                    oninput="builder.updateProp('radius', this.value)">
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="b-filled" class="accent-blue-500 mr-2"
                                    onchange="builder.toggleFill()">
                                <label for="b-filled" class="text-xs text-zinc-300">Filled</label>
                            </div>
                        </div>
                    </div>
                    <button onclick="builder.deleteSegment()"
                        class="w-full mt-2 text-xs text-red-400 hover:text-red-300 py-2">Delete Segment</button>
                </div>
            </div>

            <div class="pt-4 border-t border-white/5">
                <button onclick="builder.saveAndAdd()"
                    class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl font-bold text-sm shadow-lg shadow-blue-900/20 transition">Add
                    to Scene</button>
            </div>
        </div>
    </div>
</div>

<!-- Library Modal -->
<div id="library-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-zinc-900 border border-zinc-700 w-full max-w-md rounded-2xl shadow-2xl p-6">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-bold text-white">Library</h3>
            <button onclick="app.closeLibrary()" class="text-zinc-500 hover:text-white">‚úï</button>
        </div>
        <div class="grid grid-cols-3 gap-3">
            <button onclick="app.addFromLibrary('stickman')"
                class="aspect-square flex flex-col items-center justify-center bg-zinc-800 hover:bg-zinc-700 rounded-xl border border-zinc-700 hover:border-blue-500/50 transition group">
                <span class="text-3xl mb-2 group-hover:scale-110 transition">üèÉ</span>
                <span class="text-xs text-zinc-400 group-hover:text-white">Stickman</span>
            </button>
            <button onclick="app.addFromLibrary('sword')"
                class="aspect-square flex flex-col items-center justify-center bg-zinc-800 hover:bg-zinc-700 rounded-xl border border-zinc-700 hover:border-blue-500/50 transition group">
                <span class="text-3xl mb-2 group-hover:scale-110 transition">‚öîÔ∏è</span>
                <span class="text-xs text-zinc-400 group-hover:text-white">Sword</span>
            </button>
            <button onclick="app.addFromLibrary('ball')"
                class="aspect-square flex flex-col items-center justify-center bg-zinc-800 hover:bg-zinc-700 rounded-xl border border-zinc-700 hover:border-blue-500/50 transition group">
                <span class="text-3xl mb-2 group-hover:scale-110 transition">‚öΩ</span>
                <span class="text-xs text-zinc-400 group-hover:text-white">Ball</span>
            </button>
            <button onclick="app.addFromLibrary('racket')"
                class="aspect-square flex flex-col items-center justify-center bg-zinc-800 hover:bg-zinc-700 rounded-xl border border-zinc-700 hover:border-blue-500/50 transition group">
                <span class="text-3xl mb-2 group-hover:scale-110 transition">üéæ</span>
                <span class="text-xs text-zinc-400 group-hover:text-white">Racket</span>
            </button>
            <button onclick="app.addFromLibrary('bike')"
                class="aspect-square flex flex-col items-center justify-center bg-zinc-800 hover:bg-zinc-700 rounded-xl border border-zinc-700 hover:border-blue-500/50 transition group">
                <span class="text-3xl mb-2 group-hover:scale-110 transition">üö≤</span>
                <span class="text-xs text-zinc-400 group-hover:text-white">Bike</span>
            </button>
            <button onclick="app.addFromLibrary('car')"
                class="aspect-square flex flex-col items-center justify-center bg-zinc-800 hover:bg-zinc-700 rounded-xl border border-zinc-700 hover:border-blue-500/50 transition group">
                <span class="text-3xl mb-2 group-hover:scale-110 transition">üöó</span>
                <span class="text-xs text-zinc-400 group-hover:text-white">Car</span>
            </button>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div id="loading-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-zinc-900 border border-zinc-700 p-8 rounded-2xl shadow-2xl flex flex-col items-center">
        <div class="loader mb-4 border-blue-500 border-t-blue-500"></div>
        <h3 class="text-lg font-bold text-white">Generating GIF</h3>
        <p class="text-zinc-500 text-sm mt-2">Rendering frames...</p>
    </div>
</div>

<!-- Confirm Modal -->
<div id="confirm-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-zinc-900 border border-zinc-700 p-6 rounded-2xl shadow-2xl max-w-sm w-full mx-4">
        <h3 id="confirm-title" class="text-lg font-bold text-white mb-2">Confirmation</h3>
        <p id="confirm-msg" class="text-zinc-400 mb-6 text-sm">Are you sure?</p>
        <div class="flex justify-end space-x-3">
            <button onclick="app.closeModal()"
                class="px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg text-sm transition">Cancel</button>
            <button id="confirm-btn" onclick="app.executeConfirm()"
                class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg text-sm font-bold transition shadow-lg shadow-red-900/20">Confirm</button>
        </div>
    </div>
</div>